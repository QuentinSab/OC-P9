{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'reviews/base_review.css' %}">
<link rel="stylesheet" href="{% static 'reviews/home.css' %}">
<link rel="stylesheet" href="{% static 'reviews/starability/starability-basic.css' %}">
{% endblock %}

{% block content %}

<div>
    <a class="button" href="{% url 'create_ticket' %}">Demander une critique</a>
    <a class="button" href="{% url 'create_ticket_and_review' %}">Créer une critique</a>
</div>

<!-- Viewables posts -->
<section>
    {% if posts %}
    {% for post in posts %}

    <!-- Viewables reviews -->
    {% if post.content_type == "review" %}

    <div class="review">

        <h3>Critique de {{ post.user }}</h3>
        <p>{{ post.headline }}</p>
        <div class="starability-result" data-rating="{{ post.rating }}" aria-label="{{ post.rating }} étoiles sur 5">
        </div>
        <p>{{ post.body }}</p>

        <!-- Linked review ticket -->
        <div class="ticket">
            <h4>Ticket lié : {{ post.ticket.title }}</h4>
            <p>{{ post.ticket.description }}</p>

            {% if post.ticket.image %}
            <div class="ticket-img">
                <img src="{{ post.ticket.image.url }}" alt="Image du ticket">
            </div>
            {% endif %}
        </div>

        <!-- Block button -->
        {% if post.user != request.user %}
        <div class="button-list">
            <form method="post" action="{% url 'block' post.user.id %}">
                {% csrf_token %}
                <button class="block" type="submit">Bloquer</button>
            </form>
        </div>
        {% endif %}

    </div>

    <!-- Viewables tickets -->
    {% elif post.content_type == "ticket" %}

    <div class="ticket">

        <h3>Ticket de {{ post.user }}</h3>
        <p>{{ post.title }}</p>
        <p>{{ post.description }}</p>

        {% if post.image %}
        <div class="ticket-img">
            <img src="{{ post.image.url }}" alt="Image du ticket">
        </div>
        {% endif %}

        {% if post.user != request.user %}
        <div class="button-list">

            <!-- Reply button -->
            <form method="get" action="{% url 'create_review' post.id %}">
                <button type="submit">Créer une critique</button>
            </form>

            <!-- Block button -->
            {% if not post.review_set.exists %}
            <form method="post" action="{% url 'block' post.user.id %}">
                {% csrf_token %}
                <button class="block" type="submit">Bloquer</button>
            </form>
            {% endif %}
        </div>
        {% endif %}

    </div>

    {% endif %}
    {% endfor %}
    {% else %}
    <p>Aucune publication pour le moment.</p>
    {% endif %}
</section>
{% endblock content %}